<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Show Line-Up Scheduler</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .tab {
            display: none;
        }
        .tab.active {
            display: block;
        }
        .tab-buttons {
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .tab-btn {
            padding: 12px 24px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            flex: 1;
            min-width: 100px;
        }
        .tab-btn.active {
            background-color: #2980b9;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: left;
        }
        th {
            background-color: #3498db;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        textarea, select, input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 16px;
            min-height: 150px;
        }
        select[multiple] {
            min-height: 200px;
        }
        button {
            padding: 12px 24px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
            width: 100%;
            font-size: 16px;
        }
        button:hover {
            background-color: #27ae60;
        }
        .dynamic-entry {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        .remove-btn {
            background-color: #e74c3c;
            padding: 5px 10px;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .remove-btn:hover {
            background-color: #c0392b;
        }
        @media (max-width: 600px) {
            .container { padding: 10px; }
            .tab-btn { padding: 10px; font-size: 14px; }
            th, td { padding: 8px; font-size: 14px; }
            textarea, select, input { font-size: 14px; min-height: 120px; }
            select[multiple] { min-height: 150px; }
            button { padding: 10px; font-size: 14px; }
            .dynamic-entry { flex-direction: column; }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Show Line-Up Scheduler</h1>

        <!-- Tab Buttons -->
        <div class="tab-buttons">
            <button class="tab-btn active" onclick="openTab('artists')">Artiesten</button>
            <button class="tab-btn" onclick="openTab('roles')">Rollen</button>
            <button class="tab-btn" onclick="openTab('competencies')">Competenties</button>
            <button class="tab-btn" onclick="openTab('conflicts')">Conflicten</button>
            <button class="tab-btn" onclick="openTab('absences')">Afwezigheden</button>
            <button class="tab-btn" onclick="openTab('lineup')">Line-Up</button>
        </div>

        <!-- Artists Tab -->
        <div id="artists" class="tab active">
            <h2>Artiesten</h2>
            <p>Voeg één artiest per regel toe: "Naam" (bijv. "John")</p>
            <textarea id="artistsInput" placeholder="John
Emma
Alex"></textarea>
            <button onclick="saveData('artists')">Artiesten Opslaan</button>
        </div>

        <!-- Roles Tab -->
        <div id="roles" class="tab">
            <h2>Rollen</h2>
            <p>Voeg één rol per regel toe: "Naam,Aantal" (bijv. "Pirate,2")</p>
            <textarea id="rolesInput" placeholder="Pirate,2
Lead Singer,1"></textarea>
            <button onclick="saveData('roles')">Rollen Opslaan</button>
        </div>

        <!-- Competencies Tab -->
        <div id="competencies" class="tab">
            <h2>Competenties</h2>
            <p>Selecteer een artiest en wijs standaardrollen en competenties toe.</p>
            <select id="compArtist" onchange="loadCompetency()"></select>
            <p>Standaardrollen:</p>
            <select id="compStandardRoles" multiple size="10"></select>
            <p>Competenties (rollen die ze kunnen vervullen):</p>
            <select id="compCompetencyRoles" multiple size="10"></select>
            <button onclick="saveCompetency()">Competenties Opslaan</button>
        </div>

        <!-- Conflicts Tab -->
        <div id="conflicts" class="tab">
            <h2>Conflicten</h2>
            <p>Selecteer een rol en geef conflicterende rollen op.</p>
            <select id="conflictRole" onchange="loadConflicts()"></select>
            <textarea id="conflictsInput" placeholder="Lijst met conflicterende rollen (bijv. Backup Singer)"></textarea>
            <button onclick="saveConflicts()">Conflicten Opslaan</button>
        </div>

        <!-- Absences Tab -->
        <div id="absences" class="tab">
            <h2>Afwezigheden & Overrides</h2>
            <p>Selecteer afwezige artiesten:</p>
            <select id="absentArtists" multiple size="10"></select>
            <p>Overrides (artiest neemt een specifieke rol over):</p>
            <div id="overridesList"></div>
            <button onclick="addOverride()">Override Toevoegen</button>
            <button onclick="saveAbsences()">Afwezigheden & Overrides Opslaan</button>
        </div>

        <!-- Line-Up Tab -->
        <div id="lineup" class="tab">
            <h2>Generated Line-Up</h2>
            <button onclick="generateLineUp()">Line-Up Genereren</button>
            <table id="lineUpTable">
                <thead>
                    <tr>
                        <th>Rol</th>
                        <th>Artiest</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="lineUpBody"></tbody>
            </table>
            <button onclick="exportToPNG()">Exporteren naar PNG</button>
        </div>
    </div>

    <script>
        // Tab handling
        function openTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`button[onclick="openTab('${tabName}')"]`).classList.add('active');
            if (tabName === 'competencies' || tabName === 'conflicts' || tabName === 'absences') loadDropdowns();
        }

        // Load saved data on page load
        window.onload = function() {
            loadData('artists', 'artistsInput');
            loadData('roles', 'rolesInput');
            loadAbsences();
            loadDropdowns();
        };

        // Save data to localStorage
        function saveData(key) {
            const input = document.getElementById(`${key}Input`);
            localStorage.setItem(key, input.value);
            loadDropdowns();
        }

        // Load data from localStorage
        function loadData(key, inputId) {
            const data = localStorage.getItem(key);
            if (data) document.getElementById(inputId).value = data;
        }

        // Parse input text
        function parseInput(text) {
            return text.trim().split('\n').map(line => line.split(','));
        }

        // Load dropdowns
        function loadDropdowns() {
            const artists = parseInput(localStorage.getItem('artists') || '');
            const roles = parseInput(localStorage.getItem('roles') || '');

            // Competencies
            const compArtist = document.getElementById('compArtist');
            const compStandardRoles = document.getElementById('compStandardRoles');
            const compCompetencyRoles = document.getElementById('compCompetencyRoles');
            compArtist.innerHTML = artists.map(([name]) => `<option value="${name}">${name}</option>`).join('');
            compStandardRoles.innerHTML = roles.map(([name]) => `<option value="${name}">${name}</option>`).join('');
            compCompetencyRoles.innerHTML = roles.map(([name]) => `<option value="${name}">${name}</option>`).join('');
            loadCompetency();

            // Conflicts
            const conflictRole = document.getElementById('conflictRole');
            conflictRole.innerHTML = roles.map(([name]) => `<option value="${name}">${name}</option>`).join('');
            loadConflicts();

            // Absences
            const absentArtists = document.getElementById('absentArtists');
            absentArtists.innerHTML = artists.map(([name]) => `<option value="${name}">${name}</option>`).join('');
            loadAbsences();
        }

        // Save and load competencies
        function saveCompetency() {
            const artist = document.getElementById('compArtist').value;
            const standardRoles = Array.from(document.getElementById('compStandardRoles').selectedOptions).map(opt => opt.value);
            const competencyRoles = Array.from(document.getElementById('compCompetencyRoles').selectedOptions).map(opt => opt.value);
            const allCompetencies = JSON.parse(localStorage.getItem('competencies') || '{}');
            allCompetencies[artist] = { standardRoles, competencyRoles };
            localStorage.setItem('competencies', JSON.stringify(allCompetencies));
        }

        function loadCompetency() {
            const artist = document.getElementById('compArtist').value;
            const allCompetencies = JSON.parse(localStorage.getItem('competencies') || '{}');
            const comp = allCompetencies[artist] || { standardRoles: [], competencyRoles: [] };
            const compStandardRoles = document.getElementById('compStandardRoles');
            const compCompetencyRoles = document.getElementById('compCompetencyRoles');
            Array.from(compStandardRoles.options).forEach(opt => opt.selected = comp.standardRoles.includes(opt.value));
            Array.from(compCompetencyRoles.options).forEach(opt => opt.selected = comp.competencyRoles.includes(opt.value));
        }

        // Save and load conflicts
        function saveConflicts() {
            const role = document.getElementById('conflictRole').value;
            const conflicts = document.getElementById('conflictsInput').value.trim().split('\n');
            const allConflicts = JSON.parse(localStorage.getItem('conflicts') || '{}');
            allConflicts[role] = conflicts;
            localStorage.setItem('conflicts', JSON.stringify(allConflicts));
        }

        function loadConflicts() {
            const role = document.getElementById('conflictRole').value;
            const allConflicts = JSON.parse(localStorage.getItem('conflicts') || '{}');
            document.getElementById('conflictsInput').value = (allConflicts[role] || []).join('\n');
        }

        // Add override
        function addOverride() {
            const roles = parseInput(localStorage.getItem('roles') || '');
            const artists = parseInput(localStorage.getItem('artists') || '');
            const div = document.createElement('div');
            div.className = 'dynamic-entry';
            div.innerHTML = `
                <select class="overrideRole">${roles.map(([name]) => `<option value="${name}">${name}</option>`).join('')}</select>
                <select class="overrideArtist">${artists.map(([name]) => `<option value="${name}">${name}</option>`).join('')}</select>
                <button class="remove-btn" onclick="this.parentElement.remove()">Verwijderen</button>
            `;
            document.getElementById('overridesList').appendChild(div);
        }

        // Save and load absences
        function saveAbsences() {
            const absent = Array.from(document.getElementById('absentArtists').selectedOptions).map(opt => opt.value);
            const overrides = Array.from(document.querySelectorAll('#overridesList .dynamic-entry')).map(entry => ({
                role: entry.querySelector('.overrideRole').value,
                artist: entry.querySelector('.overrideArtist').value
            }));
            const absences = { absent, overrides };
            localStorage.setItem('absences', JSON.stringify(absences));
        }

        function loadAbsences() {
            const data = JSON.parse(localStorage.getItem('absences') || '{}');
            if (data.absent) {
                const absentArtists = document.getElementById('absentArtists');
                data.absent.forEach(val => absentArtists.querySelector(`option[value="${val}"]`).selected = true);
            }
            document.getElementById('overridesList').innerHTML = '';
            data.overrides?.forEach(({ role, artist }) => {
                addOverride();
                const last = document.querySelector('#overridesList .dynamic-entry:last-child');
                last.querySelector('.overrideRole').value = role;
                last.querySelector('.overrideArtist').value = artist;
            });
        }

        // Generate line-up
        function generateLineUp() {
            const artists = parseInput(localStorage.getItem('artists') || '');
            const roles = parseInput(localStorage.getItem('roles') || '');
            const competencies = JSON.parse(localStorage.getItem('competencies') || '{}');
            const conflicts = JSON.parse(localStorage.getItem('conflicts') || '{}');
            const absences = JSON.parse(localStorage.getItem('absences') || '{}');

            const artistDict = {};
            artists.forEach(([name]) => {
                artistDict[name] = {
                    absent: absences.absent?.includes(name) || false,
                    standardRoles: competencies[name]?.standardRoles || [],
                    competencyRoles: competencies[name]?.competencyRoles || []
                };
            });

            const roleDict = {};
            roles.forEach(([name, qty]) => {
                roleDict[name] = { qty: parseInt(qty), conflicts: conflicts[name] || [] };
            });

            const lineUpBody = document.getElementById('lineUpBody');
            lineUpBody.innerHTML = '';

            // Apply overrides first
            absences.overrides?.forEach(({ role, artist }) => {
                if (!artistDict[artist].absent) {
                    lineUpBody.innerHTML += `<tr><td>${role}</td><td>${artist}</td><td>Override</td></tr>`;
                    // Remove from standard artist's roles if needed
                    const stdArtist = Object.keys(competencies).find(a => competencies[a].standardRoles.includes(role));
                    if (stdArtist && stdArtist !== artist) {
                        artistDict[stdArtist].standardRoles = artistDict[stdArtist].standardRoles.filter(r => r !== role);
                    }
                }
            });

            // Handle absent artists
            absences.absent?.forEach(absentArtist => {
                const stdRoles = artistDict[absentArtist].standardRoles;
                stdRoles.forEach(role => {
                    const candidates = Object.keys(artistDict).filter(a =>
                        !artistDict[a].absent &&
                        artistDict[a].competencyRoles.includes(role) &&
                        !roleDict[role].conflicts.some(conflict => artistDict[a].standardRoles.includes(conflict))
                    );
                    const replacement = candidates[0]; // Simplest: first available
                    if (replacement) {
                        lineUpBody.innerHTML += `<tr><td>${role}</td><td>${replacement}</td><td>OUT: ${absentArtist} ROLE: ${role} IN: ${replacement}</td></tr>`;
                    } else {
                        lineUpBody.innerHTML += `<tr><td>${role}</td><td>Niet toegewezen</td><td>Geen vervanger voor ${absentArtist}</td></tr>`;
                    }
                });
            });

            // Add standard assignments for present artists not overridden
            Object.keys(artistDict).forEach(artist => {
                if (!artistDict[artist].absent) {
                    const stdRoles = artistDict[artist].standardRoles.filter(role =>
                        !absences.overrides?.some(o => o.role === role)
                    );
                    stdRoles.forEach(role => {
                        lineUpBody.innerHTML += `<tr><td>${role}</td><td>${artist}</td><td>Standaard</td></tr>`;
                    });
                }
            });
        }

        // Export to PNG
        function exportToPNG() {
            html2canvas(document.getElementById('lineup')).then(canvas => {
                const link = document.createElement('a');
                link.download = 'show_lineup.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }
    </script>
</body>
</html>
